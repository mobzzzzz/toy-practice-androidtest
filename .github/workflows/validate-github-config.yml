name: Validate GitHub Configuration

on:
  workflow_call:

jobs:
  validate-github-config:
    name: Validate GitHub Configuration
    runs-on: ubuntu-latest
    steps:
      - name: Check VERSION_CODE Variable
        run: |
          if [ -z "${{ vars.VERSION_CODE }}" ]; then
            echo "β ERROR: VERSION_CODE λ³€μκ°€ μ„¤μ •λμ§€ μ•μ•μµλ‹λ‹¤!"
            echo ""
            echo "π”§ ν•΄κ²° λ°©λ²•:"
            echo "1. GitHub Repository β†’ Settings β†’ Secrets and variables β†’ Actions"
            echo "2. Variables νƒ­ ν΄λ¦­"
            echo "3. 'New repository variable' ν΄λ¦­"
            echo "4. Name: VERSION_CODE, Value: 1 μ…λ ¥"
            echo "5. 'Add variable' ν΄λ¦­"
            echo ""
            echo "π“ μμ„Έν• κ°€μ΄λ“: docs/GITHUB_SETUP_GUIDE.md"
            exit 1
          else
            echo "β… VERSION_CODE λ³€μ ν™•μΈλ¨: ${{ vars.VERSION_CODE }}"
          fi

      - name: Check ADMIN_TOKEN Secret
        run: |
          if [ -z "${{ secrets.ADMIN_TOKEN }}" ]; then
            echo "β ERROR: ADMIN_TOKEN μ‹ν¬λ¦Ώμ΄ μ„¤μ •λμ§€ μ•μ•μµλ‹λ‹¤!"
            echo ""
            echo "π”§ ν•΄κ²° λ°©λ²•:"
            echo "1. GitHub β†’ Settings β†’ Developer settings β†’ Personal access tokens"
            echo "2. 'Generate new token (classic)' ν΄λ¦­"
            echo "3. λ‹¤μ κ¶ν• μ„ νƒ:"
            echo "   - β… repo (Full control of private repositories)"
            echo "   - β… workflow (Update GitHub Action workflows)"
            echo "   - β… write:packages (Upload packages)"
            echo "4. Repository β†’ Settings β†’ Secrets and variables β†’ Actions β†’ Secrets"
            echo "5. 'New repository secret' ν΄λ¦­"
            echo "6. Name: ADMIN_TOKEN, Secret: μƒμ„±ν• ν† ν° μ…λ ¥"
            echo ""
            echo "π“ μμ„Έν• κ°€μ΄λ“: docs/GITHUB_SETUP_GUIDE.md"
            exit 1
          else
            echo "β… ADMIN_TOKEN μ‹ν¬λ¦Ώ ν™•μΈλ¨"
          fi

      - name: Test ADMIN_TOKEN Permissions
        run: |
          echo "π” ADMIN_TOKEN κ¶ν• ν…μ¤νΈ μ¤‘..."
          
          # GitHub APIλ΅ κ¶ν• ν…μ¤νΈ
          response=$(curl -s -w "HTTPSTATUS:%{http_code}" \
            -H "Authorization: token ${{ secrets.ADMIN_TOKEN }}" \
            -H "Accept: application/vnd.github.v3+json" \
            "https://api.github.com/repos/${{ github.repository }}")
          
          http_code=$(echo "$response" | tr -d '\n' | sed -e 's/.*HTTPSTATUS://')
          
          if [ "$http_code" = "200" ]; then
            echo "β… ADMIN_TOKEN κ¶ν• ν™•μΈλ¨"
          elif [ "$http_code" = "401" ]; then
            echo "β ERROR: ADMIN_TOKENμ΄ μ ν¨ν•μ§€ μ•μµλ‹λ‹¤!"
            echo ""
            echo "π”§ ν•΄κ²° λ°©λ²•:"
            echo "1. Personal Access Tokenμ΄ λ§λ£λμ—λ”μ§€ ν™•μΈ"
            echo "2. μƒλ΅μ΄ ν† ν° μƒμ„± ν›„ ADMIN_TOKEN μ‹ν¬λ¦Ώ μ—…λ°μ΄νΈ"
            echo ""
            echo "π“ μμ„Έν• κ°€μ΄λ“: docs/GITHUB_SETUP_GUIDE.md"
            exit 1
          elif [ "$http_code" = "403" ]; then
            echo "β ERROR: ADMIN_TOKEN κ¶ν•μ΄ λ¶€μ΅±ν•©λ‹λ‹¤!"
            echo ""
            echo "π”§ ν•΄κ²° λ°©λ²•:"
            echo "1. Personal Access Tokenμ— λ‹¤μ κ¶ν• μ¶”κ°€:"
            echo "   - β… repo (Full control of private repositories)"
            echo "   - β… workflow (Update GitHub Action workflows)"
            echo "   - β… write:packages (Upload packages)"
            echo "2. μƒλ΅μ΄ ν† ν°μΌλ΅ ADMIN_TOKEN μ‹ν¬λ¦Ώ μ—…λ°μ΄νΈ"
            echo ""
            echo "π“ μμ„Έν• κ°€μ΄λ“: docs/GITHUB_SETUP_GUIDE.md"
            exit 1
          else
            echo "β οΈ WARNING: GitHub API μ‘λ‹µ μ½”λ“: $http_code"
            echo "λ„¤νΈμ›ν¬ λ¬Έμ μ΄κ±°λ‚ GitHub μ„λΉ„μ¤ μ¥μ• μΌ μ μμµλ‹λ‹¤."
            echo "GitHub Status ν™•μΈ: https://www.githubstatus.com/"
          fi 