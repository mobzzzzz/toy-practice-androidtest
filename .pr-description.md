## ğŸ”§ Version Code ê²½í•© ìƒíƒœ ë° APK ë¹Œë“œ ìˆœì„œ ë¬¸ì œ í•´ê²°

### âš ï¸ **ë¬¸ì œ ì‹œë‚˜ë¦¬ì˜¤ 1: ë² íƒ€ ë¦´ë¦¬ì¦ˆ ê²½í•© ìƒíƒœ**

devì™€ main ë¸Œëœì¹˜ì— ë™ì‹œ ë¨¸ì§€ ì‹œ ë°œìƒí•  ìˆ˜ ìˆëŠ” ê²½í•© ìƒíƒœ:

```
ì‹œê°„: 12:00:00 - PR #A dev ë¨¸ì§€ â†’ CD ì‹œì‘ (VERSION_CODE=21 ì½ìŒ)
ì‹œê°„: 12:02:00 - PR #B main ë¨¸ì§€ â†’ VERSION_CODE=21â†’22 ì—…ë°ì´íŠ¸  
ì‹œê°„: 12:05:00 - PR #A ë² íƒ€ ë¦´ë¦¬ì¦ˆ ìƒì„± (version code: 21 ì‚¬ìš©) âŒ

ê²°ê³¼: ë² íƒ€ê°€ êµ¬ë²„ì „ ì½”ë“œ ì‚¬ìš©!
```

### âš ï¸ **ë¬¸ì œ ì‹œë‚˜ë¦¬ì˜¤ 2: main ë¨¸ì§€ ì‹œ APK ë¹Œë“œ ìˆœì„œ**

```
1. ë² íƒ€ ë¦´ë¦¬ì¦ˆ: version code 21
2. main ë¨¸ì§€ ì‹œì‘: APK ë¹Œë“œ (version code 21 ì‚¬ìš©) âŒ
3. ìƒˆ ë² íƒ€ ë¦´ë¦¬ì¦ˆ: version code 21 
4. main ë¦´ë¦¬ì¦ˆ ì™„ë£Œ: VERSION_CODE 21â†’22 ì—…ë°ì´íŠ¸ (í•˜ì§€ë§Œ APKëŠ” ì´ë¯¸ 21ë¡œ ë¹Œë“œë¨)
5. 3ë²ˆ ë² íƒ€ë¥¼ mainì— ë¨¸ì§€: 
   - APK ë¹Œë“œ ì‹œ version code 22 ì‚¬ìš©
   - VERSION_CODE 22â†’23 ì—…ë°ì´íŠ¸
   - ë¦´ë¦¬ì¦ˆ ë…¸íŠ¸ì— 23 í‘œì‹œ âŒ (APKëŠ” 22ì¸ë° ë…¸íŠ¸ëŠ” 23)

ê²°ê³¼: APKì™€ ë¦´ë¦¬ì¦ˆ ë…¸íŠ¸ì˜ version code ë¶ˆì¼ì¹˜!
```

### ğŸ¯ **ë¬¸ì œì **

1. **Version Code ë¶ˆì¼ì¹˜**
   - ë² íƒ€ ë¦´ë¦¬ì¦ˆê°€ ì´ë¯¸ ì—…ë°ì´íŠ¸ëœ version code ì‚¬ìš© ëª»í•¨
   - ë¦´ë¦¬ì¦ˆ ë²„ì „ê³¼ ë² íƒ€ ë²„ì „ì˜ version codeê°€ ë™ì¼í•´ì§

2. **APK ì„¤ì¹˜ ë¬¸ì œ**
   - ë² íƒ€(21) â†’ ë¦´ë¦¬ì¦ˆ(21) â†’ ë‹¤ìŒ ë² íƒ€(21) ìˆœì„œ ì‹œ ë¬¸ì œ
   - ì‚¬ìš©ìê°€ í˜¼ë€ìŠ¤ëŸ¬ìš´ ë²„ì „ ê´€ë¦¬ ê²½í—˜

### âœ¨ **í•´ê²° ë°©ë²•**

#### ğŸ”„ **1. ë² íƒ€ ë¦´ë¦¬ì¦ˆ ìƒì„± ì‹œ ìµœì‹  VERSION_CODE ì¬í™•ì¸**

```yaml
- name: Get Latest Version Code
  uses: actions/github-script@v7
  script: |
    // GitHub APIë¡œ ìµœì‹  VERSION_CODE ë‹¤ì‹œ ì½ê¸°
    const { data: variable } = await github.rest.actions.getRepoVariable({
      owner: context.repo.owner,
      repo: context.repo.repo,
      name: 'VERSION_CODE'
    });
    
    const latestVersionCode = variable.value;
    const originalVersionCode = '${{ needs.version-management.outputs.version_code }}';
    
    if (originalVersionCode !== latestVersionCode) {
      console.log(`âš ï¸ Version code changed during workflow execution!`);
      console.log(`Using latest version code: ${latestVersionCode}`);
    }
```

#### ğŸ—ï¸ **2. main ë¨¸ì§€ ì‹œ Version Code ì—…ë°ì´íŠ¸ ìˆœì„œ ë³€ê²½**

**ê¸°ì¡´**: APK ë¹Œë“œ â†’ VERSION_CODE ì—…ë°ì´íŠ¸
**ê°œì„ **: VERSION_CODE ì—…ë°ì´íŠ¸ â†’ APK ë¹Œë“œ

```yaml
# 1ë‹¨ê³„: Version Code ë¨¼ì € ì—…ë°ì´íŠ¸
update-version-code:
  name: Update Version Code
  if: github.base_ref == 'main'
  steps:
    - name: Update Version Code
      script: |
        const newVersion = currentVersion + 1;
        await github.rest.actions.updateRepoVariable({
          name: 'VERSION_CODE',
          value: newVersion.toString()
        });

# 2ë‹¨ê³„: ì—…ë°ì´íŠ¸ëœ Version Codeë¡œ APK ë¹Œë“œ
build-for-deploy-main:
  name: Build for Deploy (Main)
  needs: [update-version-code]
  steps:
    - name: Build APK
      env:
        VERSION_CODE: ${{ vars.VERSION_CODE }}  # ì´ë¯¸ ì—…ë°ì´íŠ¸ëœ ê°’
```

#### ğŸ“ **3. ë¦´ë¦¬ì¦ˆ ë…¸íŠ¸ì— ë³€ê²½ ì•Œë¦¼ ì¶”ê°€**

```markdown
**Version Code**: 22
**âš ï¸ ì°¸ê³ **: ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ì¤‘ Version Codeê°€ ì—…ë°ì´íŠ¸ë˜ì–´ ìµœì‹  ê°’ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
```

### ğŸ¯ **ê°œì„  íš¨ê³¼**

#### **1. ë² íƒ€ ë¦´ë¦¬ì¦ˆ ê²½í•© ìƒíƒœ í•´ê²°**
```
ì‹œê°„: 12:00:00 - PR #A dev ë¨¸ì§€ â†’ CD ì‹œì‘ (VERSION_CODE=21)
ì‹œê°„: 12:02:00 - PR #B main ë¨¸ì§€ â†’ VERSION_CODE=21â†’22
ì‹œê°„: 12:05:00 - PR #A ë² íƒ€ ìƒì„± ì‹œ ìµœì‹  í™•ì¸ â†’ VERSION_CODE=22 ì‚¬ìš© âœ…

ê²°ê³¼: ë² íƒ€ê°€ ìµœì‹  version code ì‚¬ìš©!
```

#### **2. main ë¨¸ì§€ ì‹œ APKì™€ ë¦´ë¦¬ì¦ˆ ë…¸íŠ¸ ì¼ì¹˜**
```
ê¸°ì¡´ ë¬¸ì œ:
1. ë² íƒ€ ë¦´ë¦¬ì¦ˆ: version code 21
2. main ë¨¸ì§€: APK(21) + ë¦´ë¦¬ì¦ˆë…¸íŠ¸(22) âŒ ë¶ˆì¼ì¹˜!

ê°œì„  í›„:
1. ë² íƒ€ ë¦´ë¦¬ì¦ˆ: version code 21  
2. main ë¨¸ì§€: VERSION_CODE 21â†’22 ì—…ë°ì´íŠ¸
3. main ë¨¸ì§€: APK(22) + ë¦´ë¦¬ì¦ˆë…¸íŠ¸(22) âœ… ì¼ì¹˜!
```

#### **3. ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ ì˜ˆìƒ ê²°ê³¼**
```
1. ë² íƒ€ ë¦´ë¦¬ì¦ˆ: version code 21
2. mainì— ë¨¸ì§€ (ì•„ì§ version code 21)
3. ìƒˆ ë² íƒ€ ë¦´ë¦¬ì¦ˆ: version code 21 (CD ë¨¼ì € ì™„ë£Œ)
4. main ë¦´ë¦¬ì¦ˆ ì™„ë£Œ: version code 22 (APKë„ 22ë¡œ ë¹Œë“œë¨) âœ…
5. 3ë²ˆ ë² íƒ€ë¥¼ mainì— ë¨¸ì§€: 
   - VERSION_CODE 22â†’23 ì—…ë°ì´íŠ¸
   - APK version code 23ìœ¼ë¡œ ë¹Œë“œ âœ…
   - ë¦´ë¦¬ì¦ˆ ë…¸íŠ¸ì— 23 í‘œì‹œ âœ…

ê²°ê³¼: APKì™€ ë¦´ë¦¬ì¦ˆ ë…¸íŠ¸ ì™„ì „ ì¼ì¹˜!
```

### ğŸ” **ë³€ê²½ì‚¬í•­**

1. **ì›Œí¬í”Œë¡œìš° ì‘ì—… ë¶„ë¦¬ ë° ìˆœì„œ ë³€ê²½**
   - `build-for-deploy` â†’ `build-for-deploy-dev` + `build-for-deploy-main`ìœ¼ë¡œ ë¶„ë¦¬
   - main ë¨¸ì§€ ì‹œ: `update-version-code` â†’ `build-for-deploy-main` ìˆœì„œë¡œ ì‹¤í–‰
   - dev ë¨¸ì§€ ì‹œ: ê¸°ì¡´ ìˆœì„œ ìœ ì§€

2. **`Get Latest Version Code` ìŠ¤í… ì¶”ê°€**
   - GitHub APIë¡œ ìµœì‹  VERSION_CODE ì¬í™•ì¸
   - ë³€ê²½ ì—¬ë¶€ ê°ì§€ ë° ë¡œê¹…

3. **ë¦´ë¦¬ì¦ˆ ë…¸íŠ¸ ê°œì„ **
   - ìµœì‹  version code ì‚¬ìš©
   - ë³€ê²½ ì‹œ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ í‘œì‹œ

4. **ì˜ì¡´ì„± ê´€ê³„ ëª…í™•í™”**
   - dev: `build-for-deploy-dev` â†’ `version-management` â†’ `create-beta-release`
   - main: `update-version-code` â†’ `build-for-deploy-main` â†’ `create-release-tag` â†’ `create-release`

5. **íˆ¬ëª…í•œ ë¡œê¹…**
   - ì›ë³¸ vs ìµœì‹  version code ë¹„êµ
   - ë³€ê²½ ê°ì§€ ì‹œ ëª…í™•í•œ ë©”ì‹œì§€

### ğŸ’¡ **ì¶”ê°€ ê³ ë ¤ì‚¬í•­**

- **ì„±ëŠ¥ ì˜í–¥**: ì¶”ê°€ API í˜¸ì¶œ 1íšŒ (ë¬´ì‹œí•  ìˆ˜ì¤€)
- **ì•ˆì •ì„±**: GitHub API ì‹¤íŒ¨ ì‹œì—ë„ ê¸°ì¡´ ë¡œì§ ìœ ì§€
- **íˆ¬ëª…ì„±**: ëª¨ë“  ë³€ê²½ì‚¬í•­ì´ ë¡œê·¸ì™€ ë¦´ë¦¬ì¦ˆ ë…¸íŠ¸ì— ê¸°ë¡

### ğŸ§ª **í…ŒìŠ¤íŠ¸ ë°©ë²•**

1. dev PRê³¼ main PRì„ ê±°ì˜ ë™ì‹œì— ë¨¸ì§€
2. ë² íƒ€ ë¦´ë¦¬ì¦ˆì˜ version codeê°€ ìµœì‹  ê°’ ì‚¬ìš©í•˜ëŠ”ì§€ í™•ì¸
3. ë¦´ë¦¬ì¦ˆ ë…¸íŠ¸ì— ë³€ê²½ ì•Œë¦¼ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸ 